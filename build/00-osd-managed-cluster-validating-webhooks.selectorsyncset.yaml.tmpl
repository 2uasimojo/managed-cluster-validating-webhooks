apiVersion: v1
kind: Template
parameters:
- name: IMAGE_TAG
  required: true
- name: REPO_NAME
  value: managed-cluster-validating-webhooks
  required: true
metadata:
  name: selectorsyncset-template
objects:
- apiVersion: hive.openshift.io/v1alpha1
  kind: SelectorSyncSet
  metadata:
    labels:
      managed.openshift.io/gitHash: ${IMAGE_TAG}
      managed.openshift.io/gitRepoName: ${REPO_NAME}
      managed.openshift.io/osd: 'true'
    name: managed-cluster-validating-webhooks
  spec:
    clusterDeploymentSelector:
      matchLabels:
        api.openshift.com/managed: 'true'
    resourceApplyMode: sync
    resources:
    - apiVersion: v1
      kind: Namespace
      metadata:
        name: openshift-validation-webhook
        annotations:
          openshift.io/node-selector: ''
    - apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: webhook-validation-cr
        rules:
        - apiGroups:
          - admissionregistration.k8s.io
        resources:
          - validatingwebhookconfigurations
        verbs:
          - list
            - patch
            - get
        - apiGroups:
          - ""
        resources:
          - configmaps
        verbs:
          - list
          - get
    - apiVersion: operators.coreos.com/v1alpha2
      kind: OperatorGroup
      metadata:
        name: dedicated-admin-operator
        namespace: openshift-dedicated-admin
      spec:
        targetNamespaces:
        - openshift-dedicated-admin
    - apiVersion: v1
      kind: ServiceAccount
      metadata:
      name: validation-webhook
      namespace: openshift-validation-webhook
    - apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
      name: webhook-validation
      roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: webhook-validation-cr
      subjects:
      - kind: ServiceAccount
          name: validation-webhook
          namespace: openshift-validation-webhook
    - apiVersion: v1
      kind: ConfigMap
      metadata:
      annotations:
          service.beta.openshift.io/inject-cabundle: "true"
      name: webhook-cert
      namespace: openshift-validation-webhook
      # data.(service-ca.crt) is filled in by openshift-ca-operator
      data: {}